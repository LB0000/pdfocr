# 管理ポータル 詳細設計書

## 1. 概要

管理ポータルは、PDF2MD拡張システムのユーザーインターフェースとして、OCR結果の確認・修正、帳票テンプレート管理、システム運用管理のための統合的なWebインターフェースを提供します。ユーザーからのフィードバックを踏まえ、認識結果プレビュー・補正UIを最優先で設計・実装します。

## 2. 機能要件

### 2.1 ダッシュボード機能

#### 2.1.1 処理状況サマリー
- ステータス別ドキュメント数（待機中、処理中、修正待ち、完了、エラー）
- 日次/週次/月次の処理統計
- エラー発生状況と傾向分析
- システムリソース使用状況（ストレージ、API呼び出し数等）

#### 2.1.2 最近の処理履歴
- 最近処理したドキュメント一覧
- ステータス別フィルタリング
- クイックアクション（詳細表示、再処理、削除等）
- バッチ処理状況モニタリング

#### 2.1.3 パフォーマンス指標
- OCR処理時間の平均/最大/最小
- 認識精度の統計（修正率、エラー率等）
- テンプレート別の処理統計
- ユーザー別の作業統計

### 2.2 認識結果プレビュー・補正機能（最優先）

#### 2.2.1 ドキュメントプレビュー
- PDF原本表示（ページ切替、ズーム、回転機能）
- フィールド位置ハイライト表示
- 認識テキストオーバーレイ表示
- スクロール同期機能（原本と認識結果）

#### 2.2.2 認識結果編集
- インラインテキスト編集
- フィールド値一括編集
- バリデーションエラー表示・修正
- 修正履歴表示・比較

#### 2.2.3 補正支援機能
- 修正候補表示（辞書参照、パターンマッチング等）
- ショートカットキー対応（Tab移動、Enter確定等）
- 一括置換機能
- 自動補完機能

#### 2.2.4 レビュー・承認フロー
- 修正内容のレビュー機能
- 承認/差し戻しワークフロー
- コメント・注釈機能
- 承認履歴の記録

### 2.3 検索・フィルタ機能

#### 2.3.1 ドキュメント検索
- 全文検索（OCR結果テキスト内）
- メタデータ検索（ファイル名、アップロード日時、ステータス等）
- フィールド値検索（特定フィールドの値で検索）
- 複合検索条件（AND/OR/NOT演算子）

#### 2.3.2 フィルタリング
- ステータスによるフィルタ
- 日付範囲によるフィルタ
- テンプレートタイプによるフィルタ
- ユーザーによるフィルタ
- バリデーションエラーの有無によるフィルタ

#### 2.3.3 検索結果管理
- 検索結果の並べ替え（日付、名前、ステータス等）
- 検索条件の保存・再利用
- 検索結果のエクスポート
- バッチ処理（一括承認、一括エクスポート等）

### 2.4 エクスポート・API連携機能

#### 2.4.1 データエクスポート
- CSV形式エクスポート
- JSON形式エクスポート
- Excel形式エクスポート
- カスタムフォーマットエクスポート（テンプレート定義）

#### 2.4.2 API連携
- RESTful API提供
- Webhook通知機能
- バッチ処理API
- 認証・認可管理

#### 2.4.3 外部システム連携
- RPA連携インターフェース
- 社内システム連携設定
- データマッピング設定
- スケジュール実行設定

## 3. 技術設計

### 3.1 コンポーネント構成

```
┌─────────────────────────────────────────────────────────────────┐
│                      管理ポータル                               │
│                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │  ダッシュボード  │  │  ドキュメント管理 │  │  システム設定   │  │
│  │  コンポーネント  │  │  コンポーネント   │  │  コンポーネント │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 3.1.1 ダッシュボードコンポーネント
- 統計データ集計・表示
- チャート・グラフ生成
- アラート・通知管理
- クイックアクション処理

#### 3.1.2 ドキュメント管理コンポーネント
- ドキュメント一覧表示・検索
- OCR結果プレビュー・編集
- バリデーション処理
- ワークフロー管理

#### 3.1.3 システム設定コンポーネント
- ユーザー管理
- テンプレート管理
- 辞書・ルール管理
- システム設定管理

### 3.2 フロントエンド設計

#### 3.2.1 技術スタック
- Next.js（既存）
- TypeScript（既存）
- React（既存）
- TailwindCSS（既存）
- React Query（新規：APIデータ管理）
- React Hook Form（新規：フォーム管理）
- Zustand（新規：状態管理）
- React PDF（新規：PDF表示）
- React Table（新規：データテーブル）
- Recharts（新規：グラフ・チャート）

#### 3.2.2 コンポーネント階層

```
App
├── Layout
│   ├── Header
│   ├── Sidebar
│   └── Footer
├── Pages
│   ├── Dashboard
│   ├── DocumentList
│   ├── DocumentEditor
│   ├── TemplateManager
│   ├── UserManager
│   └── SystemSettings
└── Shared
    ├── UI Components
    │   ├── Button
    │   ├── Input
    │   ├── Modal
    │   ├── Table
    │   └── ...
    ├── Hooks
    │   ├── useAuth
    │   ├── useDocuments
    │   ├── useTemplates
    │   └── ...
    └── Utils
        ├── api
        ├── validation
        ├── formatting
        └── ...
```

#### 3.2.3 状態管理
- グローバル状態：Zustand（認証情報、システム設定等）
- サーバー状態：React Query（API取得データ、キャッシュ等）
- フォーム状態：React Hook Form（入力値、バリデーション等）
- ローカル状態：React useState/useReducer（UI状態等）

### 3.3 バックエンド連携

#### 3.3.1 API通信
- RESTful API呼び出し
- JWT認証
- エラーハンドリング
- リトライ・バックオフ戦略

#### 3.3.2 リアルタイム更新
- WebSocket接続（処理状況のリアルタイム更新）
- ポーリング（定期的なステータス確認）
- 最適化されたデータフェッチング（部分更新）

#### 3.3.3 ファイル処理
- ファイルアップロード（チャンク分割、プログレス表示）
- ファイルダウンロード（一括、個別）
- ファイルプレビュー（PDF、画像等）

## 4. UI設計

### 4.1 ダッシュボード画面

#### 4.1.1 レイアウト
```
┌─────────────────────────────────────────────────────────────────┐
│ ヘッダー（ロゴ、ユーザー情報、通知、ヘルプ）                      │
├─────────┬───────────────────────────────────────────────────────┤
│         │ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐      │
│         │ │ 処理待ち     │ │ 処理中      │ │ 修正待ち     │      │
│         │ │ 10件        │ │ 5件         │ │ 15件        │      │
│ サイド  │ └─────────────┘ └─────────────┘ └─────────────┘      │
│ バー    │ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐      │
│         │ │ 完了        │ │ エラー      │ │ 合計        │      │
│ ・ダッシュ│ │ 100件       │ │ 2件         │ │ 132件       │      │
│ ボード  │ └─────────────┘ └─────────────┘ └─────────────┘      │
│         │ ┌───────────────────────────┐ ┌───────────────────┐  │
│ ・ドキュ │ │                           │ │                   │  │
│ メント  │ │ 処理統計グラフ             │ │ 最近の処理履歴    │  │
│         │ │ （日次/週次/月次）         │ │                   │  │
│ ・テンプ │ │                           │ │                   │  │
│ レート  │ └───────────────────────────┘ └───────────────────┘  │
│         │ ┌───────────────────────────┐ ┌───────────────────┐  │
│ ・設定  │ │                           │ │                   │  │
│         │ │ 認識精度統計              │ │ システム状態      │  │
│         │ │                           │ │                   │  │
│         │ └───────────────────────────┘ └───────────────────┘  │
└─────────┴───────────────────────────────────────────────────────┘
```

#### 4.1.2 主要コンポーネント
- ステータスカード：各ステータスのドキュメント数を表示
- 処理統計グラフ：折れ線グラフで処理数の推移を表示
- 最近の処理履歴：テーブル形式で最近のドキュメントを表示
- 認識精度統計：円グラフで修正率・エラー率を表示
- システム状態：APIリクエスト数、ストレージ使用量等を表示

### 4.2 ドキュメント一覧画面

#### 4.2.1 レイアウト
```
┌─────────────────────────────────────────────────────────────────┐
│ ヘッダー                                                        │
├─────────┬───────────────────────────────────────────────────────┤
│         │ ┌───────────────────────────────────────────────────┐ │
│         │ │ 検索・フィルタバー                                │ │
│         │ └───────────────────────────────────────────────────┘ │
│ サイド  │ ┌───────────────────────────────────────────────────┐ │
│ バー    │ │ アクションボタン（新規、一括処理、エクスポート等）  │ │
│         │ └───────────────────────────────────────────────────┘ │
│         │ ┌───────────────────────────────────────────────────┐ │
│         │ │                                                   │ │
│         │ │ ドキュメント一覧テーブル                          │ │
│         │ │ ・ファイル名                                      │ │
│         │ │ ・アップロード日時                                │ │
│         │ │ ・ステータス                                      │ │
│         │ │ ・テンプレート                                    │ │
│         │ │ ・処理時間                                        │ │
│         │ │ ・アクション                                      │ │
│         │ │                                                   │ │
│         │ └───────────────────────────────────────────────────┘ │
│         │ ┌───────────────────────────────────────────────────┐ │
│         │ │ ページネーション                                  │ │
│         │ └───────────────────────────────────────────────────┘ │
└─────────┴───────────────────────────────────────────────────────┘
```

#### 4.2.2 主要コンポーネント
- 検索・フィルタバー：テキスト検索、日付範囲、ステータス等のフィルタ
- アクションボタン：新規アップロード、一括処理、エクスポート等
- ドキュメント一覧テーブル：ソート可能なカラム、ステータスアイコン、クイックアクション
- ページネーション：ページ切替、表示件数設定

### 4.3 認識結果プレビュー・補正画面（最優先）

#### 4.3.1 レイアウト
```
┌─────────────────────────────────────────────────────────────────┐
│ ヘッダー（ドキュメント名、ステータス、保存/承認ボタン等）        │
├─────────┬───────────────────────────────────────────────────────┤
│         │ ┌───────────────────────┐ ┌───────────────────────┐  │
│         │ │ ツールバー            │ │ フィールド情報        │  │
│         │ │ （ズーム、ページ移動等）│ │ （選択フィールド詳細） │  │
│ サイド  │ └───────────────────────┘ └───────────────────────┘  │
│ バー    │ ┌───────────────────────┐ ┌───────────────────────┐  │
│         │ │                       │ │                       │  │
│ ・フィー │ │                       │ │                       │  │
│ ルド    │ │                       │ │                       │  │
│ リスト  │ │ PDF原本表示           │ │ 認識結果編集          │  │
│         │ │ （フィールドハイライト）│ │ （インライン編集）    │  │
│ ・ページ │ │                       │ │                       │  │
│ リスト  │ │                       │ │                       │  │
│         │ │                       │ │                       │  │
│         │ └───────────────────────┘ └───────────────────────┘  │
│         │ ┌───────────────────────────────────────────────────┐ │
│         │ │ バリデーションエラー・警告一覧                    │ │
│         │ └───────────────────────────────────────────────────┘ │
└─────────┴───────────────────────────────────────────────────────┘
```

#### 4.3.2 主要コンポーネント
- PDF原本表示：ズーム、回転、ページ切替機能付き
- フィールドハイライト：認識フィールドの位置を視覚化
- 認識結果編集：インラインテキスト編集、候補表示
- フィールド情報：選択中フィールドの詳細情報、バリデーション状態
- バリデーションエラー一覧：エラー・警告の一覧と修正ナビゲーション

#### 4.3.3 インタラクション設計
- フィールド選択：PDF上のハイライト領域クリックまたはフィールドリストから選択
- テキスト編集：インラインエディタでの直接編集、候補選択
- ページ移動：サムネイルクリックまたはページナビゲーション
- バリデーション：リアルタイムバリデーション、エラー箇所へのジャンプ
- ショートカットキー：Tab（次フィールド）、Shift+Tab（前フィールド）、Ctrl+S（保存）等

### 4.4 テンプレート管理画面

#### 4.4.1 レイアウト
```
┌─────────────────────────────────────────────────────────────────┐
│ ヘッダー                                                        │
├─────────┬───────────────────────────────────────────────────────┤
│         │ ┌───────────────────────────────────────────────────┐ │
│         │ │ テンプレート検索・フィルタバー                    │ │
│         │ └───────────────────────────────────────────────────┘ │
│ サイド  │ ┌───────────────────────────────────────────────────┐ │
│ バー    │ │ アクションボタン（新規、インポート、エクスポート等）│ │
│         │ └───────────────────────────────────────────────────┘ │
│         │ ┌───────────────────────────────────────────────────┐ │
│         │ │                                                   │ │
│         │ │ テンプレート一覧                                  │ │
│         │ │ ・テンプレート名                                  │ │
│         │ │ ・説明                                            │ │
│         │ │ ・作成日時                                        │ │
│         │ │ ・最終更新日時                                    │ │
│         │ │ ・ステータス（アクティブ/非アクティブ）            │ │
│         │ │ ・アクション（編集、複製、削除等）                 │ │
│         │ │                                                   │ │
│         │ └───────────────────────────────────────────────────┘ │
└─────────┴───────────────────────────────────────────────────────┘
```

#### 4.4.2 テンプレート編集画面
```
┌─────────────────────────────────────────────────────────────────┐
│ ヘッダー（テンプレート名、保存ボタン等）                        │
├─────────┬───────────────────────────────────────────────────────┤
│         │ ┌───────────────────────┐ ┌───────────────────────┐  │
│         │ │ テンプレート基本情報  │ │ フィールド詳細        │  │
│ サイド  │ │ （名称、説明等）      │ │ （選択フィールド設定） │  │
│ バー    │ └───────────────────────┘ └───────────────────────┘  │
│         │ ┌───────────────────────┐ ┌───────────────────────┐  │
│ ・フィー │ │                       │ │                       │  │
│ ルド    │ │                       │ │                       │  │
│ リスト  │ │ サンプルPDF表示       │ │ フィールド一覧        │  │
│         │ │ （フィールド編集）    │ │ （追加、削除、順序変更）│  │
│ ・設定  │ │                       │ │                       │  │
│         │ │                       │ │                       │  │
│         │ └───────────────────────┘ └───────────────────────┘  │
└─────────┴───────────────────────────────────────────────────────┘
```

## 5. 実装計画

### 5.1 フェーズ1: 認識結果プレビュー・補正UI（最優先）（3週間）
- PDF表示コンポーネント実装
- フィールドハイライト機能実装
- インラインテキスト編集機能実装
- バリデーション表示機能実装

### 5.2 フェーズ2: ドキュメント管理機能（2週間）
- ドキュメント一覧画面実装
- 検索・フィルタ機能実装
- ステータス管理機能実装
- バッチ処理機能実装

### 5.3 フェーズ3: ダッシュボード機能（2週間）
- 統計データ集計機能実装
- グラフ・チャート表示実装
- 最近の処理履歴表示実装
- システム状態モニタリング実装

### 5.4 フェーズ4: エクスポート・API連携機能（2週間）
- データエクスポート機能実装
- API連携設定画面実装
- Webhook通知機能実装
- スケジュール実行機能実装

### 5.5 フェーズ5: 統合・最適化（1週間）
- パフォーマンス最適化
- エラーハンドリング強化
- ユーザビリティ改善
- ドキュメント整備

## 6. 技術的課題と対策

### 6.1 大量データの効率的表示
- **課題**: 大量のドキュメントやフィールドを効率的に表示・操作する必要がある
- **対策**: 
  - 仮想スクロール技術の採用（React Virtual）
  - ページネーションと無限スクロールの併用
  - データのキャッシュ戦略（React Query）
  - 遅延読み込み・部分読み込みの実装

### 6.2 PDF表示とインタラクション
- **課題**: PDFの表示とインタラクティブな操作（ズーム、ハイライト等）の実装が複雑
- **対策**:
  - React PDFやPDF.jsを活用したカスタムコンポーネント
  - キャンバスレイヤーによるオーバーレイ表示
  - WebWorkerを活用した処理の分離
  - メモリ使用量の最適化

### 6.3 リアルタイム更新と同期
- **課題**: 複数ユーザーによる同時編集や処理状況のリアルタイム更新
- **対策**:
  - WebSocketによるリアルタイム通知
  - 楽観的UIアップデート
  - 競合解決メカニズム
  - バックグラウンド同期

### 6.4 レスポンシブ設計
- **課題**: 複雑なUIをさまざまな画面サイズで適切に表示する
- **対策**:
  - モバイルファーストのレスポンシブデザイン
  - コンポーネントの適応的レイアウト
  - 機能の段階的表示（プログレッシブディスクロージャー）
  - タッチ操作の最適化

## 7. まとめ

本設計書では、PDF2MD拡張システムの管理ポータルについて、機能要件、技術設計、UI設計、実装計画、技術的課題と対策を詳細に定義しました。

ユーザーからのフィードバックを踏まえ、以下の優先順位で実装を進めます：

1. **認識結果プレビュー・補正UI**: ユーザーが直感的に使える補正インターフェースを最優先で実装
2. **ドキュメント管理機能**: 効率的なドキュメント検索・フィルタ機能を実装
3. **ダッシュボード機能**: 処理状況の可視化と統計情報の提供
4. **エクスポート・API連携機能**: 外部システムとの連携機能の実装

アジャイル開発アプローチを採用し、各フェーズで機能を実装・検証・改善していくことで、開発リスクを低減しながら価値を早期に提供します。特に、認識結果プレビュー・補正UIは、ユーザーの業務効率に直結する重要な機能であるため、最優先で実装します。
